<div class="container-fluid">
  <div class="row justify-content-end">
    <div class="col-md-10">
      <h1 class="text-center mb-4 font-weight-bold text-dark py-2 rounded">Search Orders</h1>

      <div class="row mb-6 justify-content-end">
        <div class="col-md-3 mb-3">
          <label for="userName" class="font-weight-bold">User Name:</label>
          <input id="userName" [(ngModel)]="userName" placeholder="Enter user name" class="form-control rounded-pill shadow-sm" />
        </div>

        <div class="col-md-3 mb-3">
          <label for="orderDate" class="font-weight-bold">Order Date (YYYY-MM-DD):</label>
          <input id="orderDate" [(ngModel)]="orderDate" placeholder="YYYY-MM-DD" class="form-control rounded-pill shadow-sm" />
        </div>

        <div class="col-md-3 mb-3">
          <label for="productName" class="font-weight-bold">Product Name:</label>
          <input id="productName" [(ngModel)]="productName" placeholder="Enter product name" class="form-control rounded-pill shadow-sm" />
        </div>

        <div class="col-md-2 d-flex align-items-end justify-content-end">
          <button (click)="searchOrders()" class="btn btn-dark rounded-pill w-100 shadow">Search</button>
        </div>
      </div>

      <div class="text-center mb-4">
        <button (click)="generatePDF()" class="btn btn-success rounded-pill shadow-sm px-4 py-2">Export as PDF</button>
      </div>

      <div class="table-responsive d-flex justify-content-center">
        <table class="table table-bordered table-striped text-center">
          <thead class="bg-black text-white">
            <tr>
              <th>ID</th>
              <th>User Name</th>
              <th>Order Date</th>
              <th>Total Amount</th>
              <th>Status</th>
              <th>Items</th>
              <th>Update Status</th>
              <th>Download</th>
            </tr>
          </thead>
          <tbody class="bg-white text-dark">
            <tr *ngFor="let order of orders">
              <td>{{ order.id }}</td>
              <td>{{ order.userName }}</td>
              <td>{{ order.orderDate | date:'yyyy-MM-dd' }}</td>
              <td>${{ order.totalAmount }}</td>
              <td>
                <span class="badge badge-{{ order.status == 1 ? 'success' : 'warning' }}">
                  {{ order.status == 1 ? 'Completed' : 'Pending' }}
                </span>
              </td>
              <td>
                <table class="table table-bordered">
                  <thead class="bg-dark text-white">
                    <tr>
                      <th>Product Name</th>
                      <th>Purchased</th>
                      <th>Not Purchasing</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let item of order.orderItems">
                      <td>{{ item.productName }}</td>
                      <td>
                        <label>
                          <input type="radio" name="purchase_{{ item.id }}" [(ngModel)]="item.isPurchased" [value]="true" (change)="checkAllItems(order)" /> purchasing
                        </label>
                      </td>
                      <td>
                        <label>
                          <input type="radio" name="notPurchase_{{ item.id }}" [(ngModel)]="item.isPurchased" [value]="false" (change)="checkAllItems(order)" /> Not buying
                        </label>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </td>
              <td>
                <button (click)="updateOrderStatus(order)" class="btn btn-dark rounded-pill shadow-sm">Update Status</button>
              </td>
              <td>
                <button (click)="generateUserOrderPDF(order)" class="btn btn-primary rounded-pill shadow-sm">Download PDF</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <ng-template #noOrders>
        <p class="text-center text-muted">No orders found.</p>
      </ng-template>
    </div>
  </div>
</div>

<!-- Styles -->
<style>
  .table th {
    background-color: #343a40;
    color: #ffffff;
    text-align: center;
  }

  .table td {
    vertical-align: middle;
    text-align: center;
  }

  .badge-success {
    background-color: #28a745;
  }

  .badge-warning {
    background-color: #ffc107;
  }

  .btn-dark {
    background-color: #2d2d2d;
    border: none;
    color: white;
    padding: 10px 20px;
    font-size: 1rem;
    border-radius: 50px;
  }
</style>
<app-admin></app-admin>
